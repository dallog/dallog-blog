{"componentChunkName":"component---src-templates-post-jsx","path":"/data-jpa-slice-page/","result":{"data":{"site":{"siteMetadata":{"title":"dal.log"}},"markdownRemark":{"id":"a7fc89de-f37c-596e-a81d-3d4fe5a795b8","excerpt":"이 글은 우테코 달록팀 크루 파랑이 작성했습니다. Spring Data JPA에서는 Pagination을 위한 두 가지 객체를 제공한다. 바로 Slice와 Page다. Repository 코드를 먼저 보자. 메서드를 보면 파라미터로  객체를 받는다.  객체는 Pagination을 위한 정보를 저장하는 객체다.  인터페이스의 구현체인 의 인스턴스를 생성하여…","html":"<blockquote>\n<p>이 글은 우테코 달록팀 크루 <a href=\"https://github.com/summerlunaa\">파랑</a>이 작성했습니다.</p>\n</blockquote>\n<p>Spring Data JPA에서는 Pagination을 위한 두 가지 객체를 제공한다. 바로 Slice와 Page다. Repository 코드를 먼저 보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MemberRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Slice</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findSliceBy</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Pageable</span> pageable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findPageBy</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Pageable</span> pageable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Controller</span>\n<span class=\"token comment\">// queryParameter를 통해 page, size를 받는다</span>\n<span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/members\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MemberResponse</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token keyword\">int</span> page<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 생략</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Service</span>\n<span class=\"token class-name\">PageRequest</span> pageRequest <span class=\"token operator\">=</span> <span class=\"token class-name\">PageRequest</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// pageRequest 생성</span>\n<span class=\"token class-name\">Slice</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> slices <span class=\"token operator\">=</span> memberRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findSliceBy</span><span class=\"token punctuation\">(</span>pageRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// repository에서 페이지 가져오기</span>\n<span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> pages <span class=\"token operator\">=</span> memberRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findPageBy</span><span class=\"token punctuation\">(</span>pageRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>메서드를 보면 파라미터로 <code class=\"language-text\">Pageable</code> 객체를 받는다. <strong><code class=\"language-text\">Pageable</code> 객체는 Pagination을 위한 정보를 저장하는 객체</strong>다. <code class=\"language-text\">Pageable</code> 인터페이스의 구현체인 <code class=\"language-text\">PageRequest</code>의 인스턴스를 생성하여 메서드 인자로 넘겨줄 수 있다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/65d143925c3decfa2843ee7004381e24/bbbf7/pagerequest.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 32.94117647058823%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABBklEQVQoz3VSWW6DQBTjOsz6toGEpL3/rVwzEYqqph+WHzCLF5buDd1OVDQPNNtRakPOCbnkF1JCInLO/+L6vtjNsT8O9K1C7wp9BOcO2RpkJ+8NlReWXrhpxbquSOuLL1yHnbyEZIRWxNhg7nN2U5h2qHR4DAwtcLc5q/JSM8Lns3EupbwVChe3Xml5RxOqE87SOJN5eOtUSPuVmyqjKKWSL7TJvyw7Ld+/ntAj4E/im+oOQx/KTIV5vhZ/xvrn3SLWaddnKWdBElSnhqqBKs6SqKqWeXuZBVzllI/lLNETnIHHuDHDgaBdV4HSqjEKkXdewRi8JUQ4xnabuTv/DKWAM0sRwQ8p/NgckM6l/AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='PageRequest static constructor' title='PageRequest static constructor' src='/static/65d143925c3decfa2843ee7004381e24/ca1dc/pagerequest.png' srcset='/static/65d143925c3decfa2843ee7004381e24/e7570/pagerequest.png 170w,\n/static/65d143925c3decfa2843ee7004381e24/f46e7/pagerequest.png 340w,\n/static/65d143925c3decfa2843ee7004381e24/ca1dc/pagerequest.png 680w,\n/static/65d143925c3decfa2843ee7004381e24/02d09/pagerequest.png 1020w,\n/static/65d143925c3decfa2843ee7004381e24/bbbf7/pagerequest.png 1280w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>PageRequest static constructor</figcaption>\n  </figure></p>\n<p><code class=\"language-text\">PageRequest</code>는 정적 팩토리 메서드 <code class=\"language-text\">of</code>를 사용하여 인스턴스를 생성할 수 있다. <code class=\"language-text\">PageRequest</code>는 인자로 page, size, 필요하다면 sort까지 받을 수 있다.</p>\n<ul>\n<li><code class=\"language-text\">page</code> : 0부터 시작하는 페이지 인덱스 번호</li>\n<li><code class=\"language-text\">size</code> : 한 페이지에 반환할 데이터의 개수</li>\n<li><code class=\"language-text\">sort</code> : 정렬 방식</li>\n</ul>\n<p>page와 size를 쿼리 파라미터로 받아 <code class=\"language-text\">PageRequest</code>를 생성하여 Repository 메서드에 넘겨주는 것으로 간단하게 Pagination을 구현할 수 있는 것이다.</p>\n<h2>Slice VS Page</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">MemberRepository</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">JpaRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">Slice</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findSliceBy</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Pageable</span> pageable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findPageBy</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Pageable</span> pageable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Repository의 메서드를 보면 반환 값으로 <code class=\"language-text\">Slice</code> 혹은 <code class=\"language-text\">Page</code>를 받을 수 있다. 둘은 어떤 차이가 있을까?</p>\n<h3>Slice</h3>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/7d61658568e3566c020b6599fc453c07/1745e/slice.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 5.294117647058823%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAATElEQVQI1w3Kyw2AIBAAUeuRj1FY0I2EgBL7r2jkMJeXWWryvNmgh6EEQ0uWLisaN+7aKLM9ChosI1uazFd1eqe/H+0ZyHkRU8I5zw8d0SEOziWYOQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='slice' title='slice' src='/static/7d61658568e3566c020b6599fc453c07/ca1dc/slice.png' srcset='/static/7d61658568e3566c020b6599fc453c07/e7570/slice.png 170w,\n/static/7d61658568e3566c020b6599fc453c07/f46e7/slice.png 340w,\n/static/7d61658568e3566c020b6599fc453c07/ca1dc/slice.png 680w,\n/static/7d61658568e3566c020b6599fc453c07/1745e/slice.png 814w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>slice</figcaption>\n  </figure></p>\n<p><code class=\"language-text\">Slice</code>는 <code class=\"language-text\">Streamable</code>을 상속받는 인터페이스로 Pagination과 관련된 여러 메서드를 갖고 있다. 대표적인 메서드 몇 가지만 살펴보자.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/c73e01b98b8943bb49f9769041dd52bd/bbbf7/slice_methods.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 67.05882352941177%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCklEQVQ4y1WT6ZKCQAyEeQcXELmP4b5E2LI8yvd/qmx3VqzdH1FmCF+6kxmra2rZpkmqqpIsz6U2RrZ5kjrPJA5D8X1fPM+Tsixl2za5XC5ikFPXtYYf+Jqzh1XEkRT40HEc+ULkeF6KXCbEESDbdcVFZFkm/TDIOI4yzbOs66oibNvWvOPxqIWtMk0kRBVuukdPWOC7KgEspElT4XsmEng+n6XrOhnhaEIMKJDD1Q5ToEkSCSDVxSajiCJZS/MLA9zEsX5AINW1AO4wWo+QTwcfYAUF9VsFgTkSzqaQFgCqdt6WCyju+15BBNJ2iqLcD9Cmj2XCFijyT6cP8EKFWap7WgjAFAUIIrRDUO0MKAvsg/OQrwpnDICwL8dVIAvUADKBClk9hnUCmqbR4RDENQsdDgcdKvMsKlFFAHMgefyrcK2MFuKaibTHoRCyLIs+E8oh0TaPVYSiVhIEUBVKhQUHEkI+//c9AqnS4IPb7Sb3+12ez6e8Xi9p21YLcTh8zwFZFaa8YAgn2OM5TAGiMg6GMPuPZQKoSPuIf+7TKsPeLZcADm9Aj34QOGI95IxMVlNoO2jper2qwsfjoWrZTz2XGBAjxLStDD9tEuMsnvSY7JYZBgpDtIRT5gFm73hD9itIV1T176bUULiiB7wtnDQVdlBGdVSaYM19VmevqLTCHS5x7fbD/Dd+AB7gbVwhB7yeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='slice methods' title='slice methods' src='/static/c73e01b98b8943bb49f9769041dd52bd/ca1dc/slice_methods.png' srcset='/static/c73e01b98b8943bb49f9769041dd52bd/e7570/slice_methods.png 170w,\n/static/c73e01b98b8943bb49f9769041dd52bd/f46e7/slice_methods.png 340w,\n/static/c73e01b98b8943bb49f9769041dd52bd/ca1dc/slice_methods.png 680w,\n/static/c73e01b98b8943bb49f9769041dd52bd/02d09/slice_methods.png 1020w,\n/static/c73e01b98b8943bb49f9769041dd52bd/bbbf7/slice_methods.png 1280w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>slice methods</figcaption>\n  </figure></p>\n<p>현재 페이지의 내용을 확인하거나 다음 페이지, 이전 페이지에 대한 정보를 가져올 수 있다. 그렇다면 <code class=\"language-text\">Page</code>는 무엇일까?</p>\n<h3>Page</h3>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/cdcdbc9212162f613deb93dccec679af/911ab/page.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 5.88235294117647%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAATklEQVQI1w3JWw5AMBBAUeupSSWVTh9IlJQisf/dXM7v6TYVnizMY8/keq4k7EE4gyFH5bhflnXDeaV4of3foiF5R6mNslc0ZbwGrB34AC6TIVh3KXKvAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='page' title='page' src='/static/cdcdbc9212162f613deb93dccec679af/ca1dc/page.png' srcset='/static/cdcdbc9212162f613deb93dccec679af/e7570/page.png 170w,\n/static/cdcdbc9212162f613deb93dccec679af/f46e7/page.png 340w,\n/static/cdcdbc9212162f613deb93dccec679af/ca1dc/page.png 680w,\n/static/cdcdbc9212162f613deb93dccec679af/911ab/page.png 710w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>page</figcaption>\n  </figure></p>\n<p><code class=\"language-text\">Page</code>는 <code class=\"language-text\">Slice</code>를 상속한다. 따라서 <code class=\"language-text\">Slice</code>가 가진 모든 메서드를 <code class=\"language-text\">Page</code>도 사용할 수 있다. 다만 <code class=\"language-text\">Page</code>가 다른 점은 <strong>조회 쿼리 이후 전체 데이터 개수를 조회하는 쿼리가 한 번 더 실행된다는 것</strong>이다.</p>\n<p>Page가 추가적으로 구현하고 있는 메서드 두 가지만 살펴보자.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/8e015d06af588554f4e07efaca3105ae/bbbf7/page_methods.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 15.294117647058824%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjklEQVQI122PSw7DIAxEc4sSyi8USAmCFIh6/5tNMdt08STLHo/HS84ZvXfUWpFSQikF53lCaw2lFLz3uK4LIYTZM8ZMqP7HEmOEtRZSSgghkJxDf+/4eIf0smO2obUOOky01uCGhjEGzvmNZR8LUjzxGAISxW0YDLPvHuC0mikp8XEc04w+oMV1XW9Q/wdm+VSCquaNqQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='page methods' title='page methods' src='/static/8e015d06af588554f4e07efaca3105ae/ca1dc/page_methods.png' srcset='/static/8e015d06af588554f4e07efaca3105ae/e7570/page_methods.png 170w,\n/static/8e015d06af588554f4e07efaca3105ae/f46e7/page_methods.png 340w,\n/static/8e015d06af588554f4e07efaca3105ae/ca1dc/page_methods.png 680w,\n/static/8e015d06af588554f4e07efaca3105ae/02d09/page_methods.png 1020w,\n/static/8e015d06af588554f4e07efaca3105ae/bbbf7/page_methods.png 1280w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>page methods</figcaption>\n  </figure></p>\n<p>Page의 경우 전체 데이터 개수를 조회하는 쿼리가 추가적으로 실행되므로 Slice와 다르게 전체 데이터 개수나 전체 페이지 수까지 확인할 수 있다.</p>\n<blockquote>\n<p>추가적으로..</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">PagingAndSortingRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> ID<span class=\"token punctuation\">></span></span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">CrudRepository</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">,</span> ID<span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">Iterable</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Sort</span> sort<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Pageable</span> pageable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">Page</code>를 반환받을 경우 아래처럼 <strong><code class=\"language-text\">Page</code>를 반환하는 <code class=\"language-text\">findAll</code> 메서드가 이미 존재</strong>한다. 따로 Repository Interface에 메서드를 추가해주지 않아도 <code class=\"language-text\">findAll</code> 메서드에 <code class=\"language-text\">Pageable</code> 객체를 넘겨주면 Pagination을 사용할 수 있다. (Slice를 반환하려면 메서드를 정의해주어야 한다.)</p>\n<h3>Slice VS Page 어떤 걸 사용해야 할까?</h3>\n<p><code class=\"language-text\">Slice</code>는 전체 데이터 개수를 조회하지 않고 이전 or 다음 <code class=\"language-text\">Slice</code>가 존재하는지만 확인할 수 있다. 따라서 <strong><code class=\"language-text\">Slice</code>는 무한 스크롤 등을 구현하는 경우 유용</strong>하다. <code class=\"language-text\">Page</code>에 비해 쿼리가 하나 덜 날아가므로 <strong>데이터 양이 많을수록 <code class=\"language-text\">Slice</code>를 사용하는 것이 성능상 유리</strong>하다.</p>\n<p><code class=\"language-text\">Page</code>는 전체 데이터 개수를 조회하는 쿼리를 한 번 더 실행한다. 따라서 <strong>전체 페이지 개수나 데이터 개수가 필요한 경우 유용</strong>하다.</p>\n<blockquote>\n<p>알록에서는 카테고리 조회를 무한 스크롤로 구현하므로 Slice를 사용했다.</p>\n</blockquote>\n<h2>컨트롤러에서 queryParameter를 Pageable 객체로 받는 방법</h2>\n<p>앞에선 queryParameter를 통해 page, size를 받아 PageRequest를 만들어 넘겨주는 방법을 설명했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// Controller</span>\n<span class=\"token comment\">// queryParameter를 통해 page, size를 받는다</span>\n<span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/members\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MemberResponse</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token keyword\">int</span> page<span class=\"token punctuation\">,</span> <span class=\"token annotation punctuation\">@RequestParam</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 생략</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>하지만 이렇게 구현하니까 <em>“ModelAttribute를 통해 queryParameter를 DTO로 받는 것처럼, queryParameter를 Pageable 객체로 받을 수 없을까?”</em>하는 의문이 생겼다. 직접 ArgumentResolver를 구현할 뻔했지만 찾아보니 역시 똑똑한 JPA.. Pageable 객체를 인수로 설정하면 어노테이션 없이도 자동으로 객체를 만들어준다. <code class=\"language-text\">PageableHandlerMethodArgumentResolver</code> 가 이미 구현되어 있기 때문이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// Controller</span>\n<span class=\"token comment\">// Pageable 객체를 바로 받을 수 있다.</span>\n<span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/api/members\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MemberResponse</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Pageable</span> pagealbe<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 생략</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Service</span>\n<span class=\"token class-name\">Slice</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> slices <span class=\"token operator\">=</span> memberRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findSliceBy</span><span class=\"token punctuation\">(</span>pageable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// PageReqeust를 생성할 필요 없이 바로 객체를 넘겨줄 수 있다.</span></code></pre></div>\n<p>이렇게 사용하면 PageReqeust를 생성할 필요 없이 바로 객체를 넘겨줄 수 있어 훨씬 편하다. 하지만 문제가 한 가지 발생한다. <strong>프론트에서는 page index를 1부터 계산하는 것과 달리 Pageable은 page index를 0부터 계산한다.</strong> 따라서 page의 인덱스를 1부터 시작하도록 설정할 필요가 있다.</p>\n<h2>page 인덱스를 1부터 시작하도록 설정하기</h2>\n<h3>방법 1. PageableHandlerMethodArgumentResolverCustomizer 커스터마이징 하기</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Configuration</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">CustomPageableConfiguration</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Bean</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">PageableHandlerMethodArgumentResolverCustomizer</span> <span class=\"token function\">customize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> p <span class=\"token operator\">-></span> p<span class=\"token punctuation\">.</span><span class=\"token function\">setOneIndexedParameters</span><span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>따로 <code class=\"language-text\">CustomPageableConfiguration</code> 클래스를 만들어 <code class=\"language-text\">PageableHandlerMethodArgumentResolverCustomizer</code>를 커스터마이징 해주는 방법이 있다. 여기서 <code class=\"language-text\">setOneIndexedParameters</code> 메서드를 통해 인덱스를 1부터 시작하게 설정할 수 있다.</p>\n<h3>방법 2. application-properties에 설정 추가하기</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">spring<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>web<span class=\"token punctuation\">.</span>pageable<span class=\"token punctuation\">.</span>one<span class=\"token operator\">-</span>indexed<span class=\"token operator\">-</span>parameters<span class=\"token operator\">=</span><span class=\"token boolean\">true</span></code></pre></div>\n<h3>유의점 1</h3>\n<p>이렇게 인덱스를 1부터 시작하도록 설정하면 <strong>단순히 Controller에서 받는 Pageable의 page 값이 -1 되어 저장될 뿐이다.</strong> Pageable 객체나 이후에 반환받은 Slice, Page 객체에서는 <strong>page 인덱스가 여전히 0부터 시작</strong>한다. </p>\n<p>따라서 getNumber 등의 메서드를 통해 page 번호를 받으면 -1씩 차이가 난다는 사실을 잊어선 안 된다. <strong>현재 페이지 index를 반환하고 싶다면 반드시 -1</strong>을 해줘야 한다. 유의해서 사용하자.</p>\n<h3>유의점 2</h3>\n<p><strong>무한 스크롤을 Slice나 Page로 구현하면 데이터가 중복으로 나타날 수 있다.</strong> </p>\n<p>예를 들어 생각해보자. 30개의 데이터를 불러왔고 10개의 데이터를 추가로 요청하려 하는데, 그 사이에 10개의 데이터가 앞에 추가되었다. 이 경우 데이터가 10개씩 밀려서 21~30번째 데이터가 중복으로 나타나게 된다.\n달록에서는 아직 이 경우까지 고려해서 페이징을 구현하지 못했다. 좀 더 고민해보아야 할 부분인 것 같다.</p>\n<h3>References</h3>\n<p><a href=\"https://tecoble.techcourse.co.kr/post/2021-08-15-pageable/\">https://tecoble.techcourse.co.kr/post/2021-08-15-pageable/</a></p>\n<p><a href=\"https://treasurebear.tistory.com/59\">https://treasurebear.tistory.com/59</a></p>\n<p><a href=\"https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Slice.html\">https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Slice.html</a></p>\n<p><a href=\"https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Page.html\">https://docs.spring.io/spring-data/commons/docs/current/api/org/springframework/data/domain/Page.html</a></p>","frontmatter":{"title":"Spring Data JPA의 Slice & Page","date":"July 18, 2022","update":"July 18, 2022","tags":["Spring","Data JPA","Slice","Page"],"series":null},"fields":{"slug":"/data-jpa-slice-page/","readingTime":{"minutes":8.45}}},"seriesList":{"edges":[{"node":{"id":"a621dc7b-8590-5ec6-9b52-3d9e5182486d","fields":{"slug":"/appearance-background-of-jpa/"},"frontmatter":{"title":"JPA 등장배경"}}},{"node":{"id":"9d2a87b6-2b9c-5b87-b790-3426d17c2d8e","fields":{"slug":"/intellij-final-keyword/"},"frontmatter":{"title":"IntelliJ에서 메소드 추출한 메소드의 파라미터에 final 키워드 자동 추가하기"}}},{"node":{"id":"251e9767-1c92-5cf5-9cef-2c4a42c10df2","fields":{"slug":"/git-branch-strategy/"},"frontmatter":{"title":"달록팀의 git 브랜치 전략을 소개합니다."}}},{"node":{"id":"5090cce3-0c1f-5376-badc-1d25e44c1bd9","fields":{"slug":"/infinite-scroll/"},"frontmatter":{"title":"React에서 무한 스크롤 구현하기"}}},{"node":{"id":"bcb53ba5-0286-5d10-96c2-fdcb88e2cc60","fields":{"slug":"/package-structure/"},"frontmatter":{"title":"달록에 적절한 패키지 구조 고민하기"}}},{"node":{"id":"a7fc89de-f37c-596e-a81d-3d4fe5a795b8","fields":{"slug":"/data-jpa-slice-page/"},"frontmatter":{"title":"Spring Data JPA의 Slice & Page"}}},{"node":{"id":"e1ba92ee-0cf0-50c8-80bd-5da5075df8d1","fields":{"slug":"/data-jpa-auditing/"},"frontmatter":{"title":"Spring Data JPA의 Auditing"}}},{"node":{"id":"3e036508-c916-504e-9e8d-89f69332471e","fields":{"slug":"/separated-interface/"},"frontmatter":{"title":"외부와 의존성 분리하기"}}},{"node":{"id":"cade544a-16ef-58a3-b97c-824986a8395f","fields":{"slug":"/apply-rest-docs/"},"frontmatter":{"title":"MockMvc를 사용한 Spring RestDocs"}}},{"node":{"id":"87649d54-d59e-58a6-afd5-8491eb4113a8","fields":{"slug":"/properties-to-object/"},"frontmatter":{"title":"properties 객체로 다루기"}}},{"node":{"id":"eb380f6d-5a00-5a9e-a916-003fb292cc8a","fields":{"slug":"/test-fixture-constant/"},"frontmatter":{"title":"테스트에서 Entity 객체를 상수로 두면 안 되는 이유"}}},{"node":{"id":"9734e30a-b430-5922-919d-f53808a56eb9","fields":{"slug":"/what_is_nginx/"},"frontmatter":{"title":"NGINX 란?"}}},{"node":{"id":"9ebc6e21-2a76-5d42-be33-c2dae8c849b2","fields":{"slug":"/ssl_protocol/"},"frontmatter":{"title":"SSL을 통한 HTTPS통신 과정"}}},{"node":{"id":"fa5ad595-1f81-5a20-a884-2da69adee3c5","fields":{"slug":"/integration-test-slice-test/"},"frontmatter":{"title":"통합 테스트와 슬라이스 테스트"}}},{"node":{"id":"d8c66823-bb05-5e83-a6a1-2fd9af450b6f","fields":{"slug":"/query-invalidation/"},"frontmatter":{"title":"React-Query에서의 데이터 최신화 (Query Invalidation)"}}},{"node":{"id":"f5187517-342f-52a1-9092-d12c1a80d132","fields":{"slug":"/seperate-components/"},"frontmatter":{"title":"컴포넌트 분리 기준"}}},{"node":{"id":"d6249c8b-bea6-5c91-8477-d3dd15ad9b39","fields":{"slug":"/test-isolation/"},"frontmatter":{"title":"테스트 격리"}}},{"node":{"id":"98e390ef-fb19-5d01-a3ef-d14bc0e65176","fields":{"slug":"/dallog-jacoco/"},"frontmatter":{"title":"달록의 Jacoco 적용기 (feat. Gradle)"}}},{"node":{"id":"33d19946-de0c-5b41-bfa0-d7c3fd80f10b","fields":{"slug":"/google-refresh-token/"},"frontmatter":{"title":"Google은 Refresh Token을 쉽게 내주지 않는다."}}},{"node":{"id":"8168857d-a82c-5608-bd40-cea4b917d17d","fields":{"slug":"/submodule/"},"frontmatter":{"title":"달록 서브모듈 도입기"}}},{"node":{"id":"836fc724-7e2f-5c7a-a42b-c0cc9163167a","fields":{"slug":"/dallog-flyway/"},"frontmatter":{"title":"달록의 데이터베이스 마이그레이션을 위한 Flyway 적용기"}}},{"node":{"id":"7a3bde6d-746b-56fd-8d91-0d8059ebf1f8","fields":{"slug":"/json-property-json-naming/"},"frontmatter":{"title":"@JsonProperty, @JsonNaming"}}},{"node":{"id":"50673f5c-f835-5982-b70c-b77e5a352a2c","fields":{"slug":"/servlet-life-cycle/"},"frontmatter":{"title":"서블릿 생명주기와 직접만든 톰캣을 통한 의문점"}}},{"node":{"id":"61e7f4d1-7b3a-5968-bfe8-c3f6efb88748","fields":{"slug":"/preparing-for-performance-test/"},"frontmatter":{"title":"톰캣 튜닝을 위한 달록의 서버 성능 테스트 준비 과정"}}},{"node":{"id":"9272061d-68c6-5f82-a961-0e2efe0fd6be","fields":{"slug":"/cyclic-dependency/"},"frontmatter":{"title":"cyclic dependency"}}},{"node":{"id":"6e779308-f266-58af-bfcc-e9fee6d39a98","fields":{"slug":"/multi-datasource-issue-with-osiv/"},"frontmatter":{"title":"대체 왜 DataSource 라우팅이 안되는거야!? (feat. OSIV)"}}},{"node":{"id":"c7bea043-345c-5f78-ae53-796a83812961","fields":{"slug":"/react-query-useMutation-trouble-shooting/"},"frontmatter":{"title":"react-query useMutation onSuccess 안 되는줄 알았던 트러블 슈팅"}}},{"node":{"id":"cf403487-1c48-5ca7-b5c2-ef0d8fefe3c4","fields":{"slug":"/jenkins-distributed-build-architecture/"},"frontmatter":{"title":"젠킨스 분산 빌드 아키텍처 구축"}}},{"node":{"id":"24c152c7-4e94-5b84-aaea-a5a9a8357693","fields":{"slug":"/zero-downtime-deployment/"},"frontmatter":{"title":"달록 무중단 배포 도입기"}}},{"node":{"id":"623f9105-974d-51b9-84c7-f6298a8d1c19","fields":{"slug":"/get-valid-accessToken/"},"frontmatter":{"title":"refreshToken으로 accessToken 재발급하기"}}},{"node":{"id":"d34299f0-eb49-5aef-a38f-963200d5fd6d","fields":{"slug":"/test-readability/"},"frontmatter":{"title":"어떻게 테스트 코드 가독성을 개선할 수 있을까??"}}},{"node":{"id":"fe27c1ec-d040-5cf4-934a-a5eeb2131dfb","fields":{"slug":"/troubleshooting-of-category-role-concurrency-issue/"},"frontmatter":{"title":"JPA의 낙관적 락을 사용한 동시성 이슈 해결"}}}]},"previous":{"fields":{"slug":"/package-structure/"},"frontmatter":{"title":"달록에 적절한 패키지 구조 고민하기"}},"next":{"fields":{"slug":"/data-jpa-auditing/"},"frontmatter":{"title":"Spring Data JPA의 Auditing"}}},"pageContext":{"id":"a7fc89de-f37c-596e-a81d-3d4fe5a795b8","series":null,"previousPostId":"bcb53ba5-0286-5d10-96c2-fdcb88e2cc60","nextPostId":"e1ba92ee-0cf0-50c8-80bd-5da5075df8d1"}},"staticQueryHashes":[]}