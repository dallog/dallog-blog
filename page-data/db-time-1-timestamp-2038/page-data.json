{"componentChunkName":"component---src-templates-post-jsx","path":"/db-time-1-timestamp-2038/","result":{"data":{"site":{"siteMetadata":{"title":"dal.log"}},"markdownRemark":{"id":"ecbb184e-af6e-56c3-bcc7-1dd21db8187d","excerpt":"이 글은 우테코 달록팀 크루 파랑이 작성했습니다. 문제 상황 달록은 스케줄의 시작 일시와 종료 일시의 타입이  로 지정되어 있다. 우리가 따로 날짜 범위에 대한 검증을 해주고 있지 않아 특정 날짜 범위를 벗어나면 아래와 같은 예외가 발생했다.  그제서야 날짜의 최대 최소 값을 알아보았다.  java의 경우 거의 무제한이라고 봐도 무방했다. 문제는 mysq…","html":"<blockquote>\n<p>이 글은 우테코 달록팀 크루 <a href=\"https://github.com/summerlunaa\">파랑</a>이 작성했습니다.</p>\n</blockquote>\n<h2>문제 상황</h2>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> schedules <span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n  start_date_time <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">,</span>\n  end_date_time <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">,</span>\n  created_at <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">,</span>\n  updated_at <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span><span class=\"token punctuation\">,</span>\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>달록은 스케줄의 시작 일시와 종료 일시의 타입이 <code class=\"language-text\">timestamp</code> 로 지정되어 있다. 우리가 따로 날짜 범위에 대한 검증을 해주고 있지 않아 특정 날짜 범위를 벗어나면 아래와 같은 예외가 발생했다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/189f8139d2e976dc3ff7b5e9d0beb928/cb866/error.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 94.11764705882352%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAAC2ElEQVQ4y21U2XLiQAzkcxKOALbBxveFzWHA3AnJ7tb+/0dou2WbSqX2oUuasUejVmvUW7qhhPlawngpARAmhTheLI4bi72IgFAWXgLEuk9/YjoymszlbQq0djy1ZWzY0jtlpdy+/sr19imny4fs66scz+9yvX/J++OPXLBfn+9yvn5g71P33CDVIAxM0B+OLQ3a2/qJ5JuDrIDlaid5WSm4Xm9r2e5Pus/1pjqqLdd7qfZnXTMBfrdsXwP3NqCR4Yc4LWWJQOlyozaDtd1IFrhw7oRNGdpS0PIbwbXrpzKzgybgMVvJ4fqQ+nhTeqR9ON3U+mEuL4OpDN8sGSjMFj/Wo2ZPA1ZhKi6ECKIcwtAuxYdP8HZr7svMCZ52DpGMmatrZm7OPaXLNeuJgJlsUIcMSj8p4hCDMThVj9OVxGBCm2Rr3Y90v9S9KCklgm9YrvRqfCBlFrk6XCDCWQvPNQO/DCbSB6X+yJD+0JBXYKBrU9e63/psod4O1ALcGoFugix4E7PirSy+2VG2A6XG4j9ptlQbP+gop7IABQ+9RboEG5rBuOehJEHb9CnKwi5grRP4BEvBRNgVvKhX4VDK/iu2TR/CZgAP0upBHGDWr1C839H9CVKmynvczD7M8o0GLOAXsNqPXLdg8afWAgp7qrLCcp/+FL4+vS0yTNjQyMRtaXeUue5A6ryEKqvirHdSPBnwQq3hrm2bA8De08NtAAUvwUDw4ZvIbjieqZqj/0Df8j7OpcCbLEGLb1Pf7+6k+P5md/VFFeUQ6CaN2p8BSTkClbRVjAqywZlpl7GqDJ8t1anb+R31tFOZlKvTHVPjom+YTe0FmQYdG44WemI0Y4p+M/cczUx9YGIuZAqoKHVayBGz74xhcHv/hbn3kPvjtyrLt8r6uRSqfZbd1GF9depAwDcEHaG2Sjml7BxPHEf4yOfGl8EApMyAPMwRpYr7qTL4Ltr3jP8BJdSR/VBK+SEAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='DataIntegrityViolationException 발생' title='DataIntegrityViolationException 발생' src='/static/189f8139d2e976dc3ff7b5e9d0beb928/ca1dc/error.png' srcset='/static/189f8139d2e976dc3ff7b5e9d0beb928/e7570/error.png 170w,\n/static/189f8139d2e976dc3ff7b5e9d0beb928/f46e7/error.png 340w,\n/static/189f8139d2e976dc3ff7b5e9d0beb928/ca1dc/error.png 680w,\n/static/189f8139d2e976dc3ff7b5e9d0beb928/02d09/error.png 1020w,\n/static/189f8139d2e976dc3ff7b5e9d0beb928/cb866/error.png 1056w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>DataIntegrityViolationException 발생</figcaption>\n  </figure></p>\n<p>그제서야 날짜의 최대 최소 값을 알아보았다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/746acead078b0d545aa4d27143510177/cd4d8/datetime.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 18.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuUlEQVQY011QSxaCMBDjJLRIS+kHEBBB9P7Xipl5snGRN0ySJi3VcRwIIcA5h5QSxnFE27bw3qPrOozTBM8puiN3QXTx/mtVKQVN08BaqwFSsK6rHrDkn0PBm541RWwsXDhfJaPQe+d+aXtOeHBWOWfUdQ1jjIac54lhGHQ3LNljxIcBJ7Hx+8YS/7vA0gcGZg07CEe+ijTJYTHIU+d51qdf3BR4k75X5M5riaA2Vvcl9pipTfxtwn8BSEx1hdSosbYAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='표' title='표' src='/static/746acead078b0d545aa4d27143510177/ca1dc/datetime.png' srcset='/static/746acead078b0d545aa4d27143510177/e7570/datetime.png 170w,\n/static/746acead078b0d545aa4d27143510177/f46e7/datetime.png 340w,\n/static/746acead078b0d545aa4d27143510177/ca1dc/datetime.png 680w,\n/static/746acead078b0d545aa4d27143510177/cd4d8/datetime.png 873w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>표</figcaption>\n  </figure></p>\n<p>java의 경우 거의 무제한이라고 봐도 무방했다. 문제는 mysql이었다.</p>\n<p>TimeStamp는 min, max 값이 너무 작았다. 이대로 계속 TimeStamp를 쓰게 되면 우리 달록 서비스의 수명은 최대 2038년이 되는 것이었다. 생각보다 이 문제가 유명해서 이를 <code class=\"language-text\">2038 문제</code>라 부른다고 한다.</p>\n<p><a href=\"https://namu.wiki/w/2038%EB%85%84%20%EB%AC%B8%EC%A0%9C\">https://namu.wiki/w/2038년 문제</a></p>\n<p>이는 캘린더 서비스를 제공하는 달록에게는 치명적인 부분이었다. <del>달록이 그때까지 살아 있으면 소원이 없겠..</del></p>\n<h2>TimeStamp와 DateTime의 차이점</h2>\n<p>TimeStamp가 DateTime과 다른 점은 <strong>시스템의 Time Zone 설정에 따라 시간이 변경</strong>된다는 것이다. 이런 특성 때문에 글로벌 서비스를 필요로 하는 경우 TimeStamp를 유용하게 사용할 수 있다.</p>\n<p>하지만 달록은 아직 글로벌 서비스를 염두에 두고 있지 않아 Time Zone에 따라 자동으로 시간이 바뀌는 것에 대한 필요성을 느끼지 못했다. 오히려 달력 서비스임에도 일정이 2038년까지만 등록되는 것이 더 큰 문제로 느껴졌다.</p>\n<blockquote>\n<p>따라서 달록은 일정의 start date time, end date time의 타입을 TimeStamp에서 DateTime으로 바꿔주기로 했다.</p>\n</blockquote>\n<h2>타입을 변경해도 서비스 로직에 문제가 생기지 않는지 확인</h2>\n<p>실제로 타입을 변경하기 전, local에서 schema.sql을 변경하여 start<em>date</em>time, end<em>date</em>time의 타입을 변경해도 서비스 로직이 잘 동작하는지 확인해보았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\">// schema.sql</span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> schedules <span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n  start_date_time <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  end_date_time <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>기본은 <code class=\"language-text\">datetime(6)</code> 이며 괄호 안의 숫자는 datetime의 소수점 자리수를 나타낸다. 최대 6자리까지 지정할 수 있다. 하지만 달록에서는 소수점까지는 사용하지 않기 때문에 <code class=\"language-text\">datetime</code> 으로 지정했다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/6cda460697a0311c52bd4337fca7fe42/26cba/select_schedules.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 18.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAt0lEQVQY012PWQ6CQBBEuYYKRgVUZJVdNgGFCIne/zbldAeJ4aMyr6ZrMl2SHldQoxKa0CmtsfczbOwIiptAdmKsrZB5S/LS+V5xEp4ts9IxuYNk3BqYxRNncZK3yg6W8MRqWPKnekxccIayWlThEOSwRfaSP5glI2vZ2GWPazMi7j4cIPbbEVH35s1ok5UZ8DZ21cOtXzynrCfYawbxZoCk/eomNXZ/dRVRQRZMVZZSJs1+qkz6Aoy5flcKRVpJAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='mysql capture' title='mysql capture' src='/static/6cda460697a0311c52bd4337fca7fe42/ca1dc/select_schedules.png' srcset='/static/6cda460697a0311c52bd4337fca7fe42/e7570/select_schedules.png 170w,\n/static/6cda460697a0311c52bd4337fca7fe42/f46e7/select_schedules.png 340w,\n/static/6cda460697a0311c52bd4337fca7fe42/ca1dc/select_schedules.png 680w,\n/static/6cda460697a0311c52bd4337fca7fe42/02d09/select_schedules.png 1020w,\n/static/6cda460697a0311c52bd4337fca7fe42/9d567/select_schedules.png 1360w,\n/static/6cda460697a0311c52bd4337fca7fe42/26cba/select_schedules.png 1782w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>mysql capture</figcaption>\n  </figure></p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/12dcc889c4e5b1f247662fc5a5423144/302da/dallog.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 24.705882352941178%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAArklEQVQY062QzQrCMBCE88SC6OP4Ch6qeFJ6U0Hw5ySlik1BrNKCilVoTDJukgra4s2FYSYfy5Jdhl+lAakUlNZfcqzOFXFNzvw9R2M8RHvqo0Uy3pyM0FmvMIi38KIQHg/R4xuXozJzx/uUu7sAwTmz/2Dx9YLZ6YBldsQidZqnCZJ7jsdT4CYK5EJ8qPp2PYWUbiD+VbSuXVnSZHOXmojrsukte0PiqsJ1yY2/AG3Mfbr0OdU+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='dallg_capture' title='dallg_capture' src='/static/12dcc889c4e5b1f247662fc5a5423144/ca1dc/dallog.png' srcset='/static/12dcc889c4e5b1f247662fc5a5423144/e7570/dallog.png 170w,\n/static/12dcc889c4e5b1f247662fc5a5423144/f46e7/dallog.png 340w,\n/static/12dcc889c4e5b1f247662fc5a5423144/ca1dc/dallog.png 680w,\n/static/12dcc889c4e5b1f247662fc5a5423144/02d09/dallog.png 1020w,\n/static/12dcc889c4e5b1f247662fc5a5423144/302da/dallog.png 1207w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>dallg_capture</figcaption>\n  </figure></p>\n<p>그 결과 타입을 datetime으로 변경해도 서비스 로직이 잘 동작하는 것을 확인할 수 있었다.</p>\n<h3>Reference</h3>\n<p><a href=\"https://kciter.so/posts/deep-dive-into-datetime\">https://kciter.so/posts/deep-dive-into-datetime</a></p>\n<p><a href=\"https://dev.mysql.com/doc/refman/8.0/en/datetime.html\">https://dev.mysql.com/doc/refman/8.0/en/datetime.html</a></p>","frontmatter":{"title":"달력 서비스의 DB 시간 다루기 1 - TimeStamp 2038 문제","date":"October 04, 2022","update":"October 04, 2022","tags":["database","time","be","파랑"],"series":"달력 서비스의 DB 시간 다루기"},"fields":{"slug":"/db-time-1-timestamp-2038/","readingTime":{"minutes":3.46}}},"seriesList":{"edges":[{"node":{"id":"ecbb184e-af6e-56c3-bcc7-1dd21db8187d","fields":{"slug":"/db-time-1-timestamp-2038/"},"frontmatter":{"title":"달력 서비스의 DB 시간 다루기 1 - TimeStamp 2038 문제"}}},{"node":{"id":"7b08be9d-63ad-5aff-b0cb-1e873d8148ec","fields":{"slug":"/db-time-2-plus-nine-hours/"},"frontmatter":{"title":"달력 서비스의 DB 시간 다루기 2 - DB에 시간이 +9 되어 저장되는 문제"}}}]},"previous":{"fields":{"slug":"/cyclic-dependency/"},"frontmatter":{"title":"cyclic dependency"}},"next":{"fields":{"slug":"/db-time-2-plus-nine-hours/"},"frontmatter":{"title":"달력 서비스의 DB 시간 다루기 2 - DB에 시간이 +9 되어 저장되는 문제"}}},"pageContext":{"id":"ecbb184e-af6e-56c3-bcc7-1dd21db8187d","series":"달력 서비스의 DB 시간 다루기","previousPostId":"9272061d-68c6-5f82-a961-0e2efe0fd6be","nextPostId":"7b08be9d-63ad-5aff-b0cb-1e873d8148ec"}},"staticQueryHashes":[]}