{"componentChunkName":"component---src-templates-post-jsx","path":"/cyclic-dependency/","result":{"data":{"site":{"siteMetadata":{"title":"dal.log"}},"markdownRemark":{"id":"9272061d-68c6-5f82-a961-0e2efe0fd6be","excerpt":"이 글은 우테코 달록팀 크루 매트가 작성했습니다. 달록팀은 와 로 이루어져 있다. 프론트엔드와 백엔드의 경우 서로의 영역을 침범할 일이 적지만 각각의 영역에서는 대부분의 코드를 공유하여 으로 태스크를 진행하게 된다. 아래는 실제 달록에서 어떠한 과정을 통해 태스트를 나누고 진행하고 있는지 설명하기 위해 백엔드에서 구성한 패키지 구조이다. 크게 3개의 기준…","html":"<blockquote>\n<p>이 글은 우테코 달록팀 크루 <a href=\"https://github.com/hyeonic\">매트</a>가 작성했습니다.</p>\n</blockquote>\n<p>달록팀은 <code class=\"language-text\">2명의 프론트엔드 개발자(티거, 나인)</code>와 <code class=\"language-text\">4명의 백엔드 개발자(파랑, 리버, 후디, 매트)</code>로 이루어져 있다. 프론트엔드와 백엔드의 경우 서로의 영역을 침범할 일이 적지만 각각의 영역에서는 대부분의 코드를 공유하여 <code class=\"language-text\">병렬적</code>으로 태스크를 진행하게 된다.</p>\n<p>아래는 실제 달록에서 어떠한 과정을 통해 태스트를 나누고 진행하고 있는지 설명하기 위해 백엔드에서 구성한 패키지 구조이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">└── src\n    ├── main\n    │   ├── java\n    │   │   └── com\n    │   │       └── allog\n    │   │           └── dallog\n    │   │               ├── domain\n    │   │               │   ├── auth\n    │   │               │   │   └── ...\n    │   │               │   ├── subscription\n    │   │               │   │   └── ...\n    │   │               │   ├── schedule\n    │   │               │   │   └── ...\n    │   │               │   └── member\n    │   │               │       └── ...\n    │   │               │    \n    │   │               ├── global\n    │   │               │   └── ...\n    │   │               │     \n    │   │               ├── infrastructure\n    │   │               │   └── oauth\n    │   │               └── AllogDallogApplication.java\n    |   |\n    │   └── resources\n    │       └── application.yml</code></pre></div>\n<p>크게 3개의 기준을 가지고 패키지 구조를 분리하였다.</p>\n<ul>\n<li><code class=\"language-text\">domain</code>: 실제 애플리케이션의 핵심이 되는 도메인 로직이 모여 있다. 애플리케이션의 주요 비즈니스 로직이 모여 있으며 <code class=\"language-text\">외부와의 의존성을 최소화</code>해야 한다. 도메인 패키지 내부에는 달록의 요구사항에 맞춰 도출된 도메인 별 패키지(e.g. auth, category, schedule 등)가 위치하고 있다. 해당 패키지 내부에는 각 도메인에서 계층 혹은 역할 별로 나뉘게 된다.</li>\n<li><code class=\"language-text\">global</code>: 프로젝트 전반에서 사용하는 객체로 구성한다.</li>\n<li><code class=\"language-text\">infrastructure</code>: 외부와 통신을 담당하는 로직이 담겨 있다.</li>\n</ul>\n<blockquote>\n<p>각각의 도메인 별 패키지(e.g. auth, category, schedule 등)를 또 한번 <code class=\"language-text\">domain</code> 패키지로 묶은 이유는 <code class=\"language-text\">global</code>과 <code class=\"language-text\">infrastructure</code>와의 의존성을 편리하게 확인하기 위한 의도가 담겨 있다. 다만 불필요하게 패키지 depth가 늘어난 것이 우려되어 팀원 과의 충분한 상의 이후 개선할 예정이다.</p>\n</blockquote>\n<h2>달록 작업 과정 시나리오</h2>\n<p>먼저 파랑이 <code class=\"language-text\">schedule</code>과 관련된 태스크를 부여받은 뒤 열심히 작업을 진행하고 있다. 달록과 지원 플랫폼 근로에 소속된 파랑은 일치감치 달록의 태스크를 마무리한 뒤 지원 플랫폼 근로를 진행하기 위해 달록 서비스 운영 코드에 작업 내역을 반영한다.</p>\n<p>그와 동시에 후디도 <code class=\"language-text\">subscription</code>과 관련된 태스크를 부여 받았다. 후디는 현재 달록에만 소속되어 있기 때문에 파랑이 지원 플랫폼 근로로 이동한 후에도 계속해서 작업을 진행하고 있다. </p>\n<p>위 시나리오만 살펴보면 서로 다른 패키지에서 태스크를 진행하기 때문에 크게 문제 되는 부분은 없어보인다. 하지만 여기에는 함정이 숨어있다. 바로 <code class=\"language-text\">schedule</code>과 <code class=\"language-text\">subscription</code>이 <code class=\"language-text\">패키지 순환 참조</code>를 하고 있기 때문이다.</p>\n<h2>의존성 비순환 원칙</h2>\n<blockquote>\n<p><strong><em>하루 종일 일해서 무언가를 작동하게 만들어 놓고 퇴근했는데, 이틑날 출근해 보면 전혀 돌아가지 않는 경험을 해본적 있지 않은가? 왜 작동하지 않게 되었나? 왜냐하면 누군가 당신보다 더 늦게까지 일하면서 당신이 <code class=\"language-text\">의존</code>하고 있던 무언가를 수정했기 때문이다. 나는 이러한 현상을 ‘숙취 증후군<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow></mrow><mrow><mi>t</mi><mi>h</mi><mi>e</mi><mi>m</mi><mi>o</mi><mi>r</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>a</mi><mi>f</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>y</mi><mi>n</mi><mi>d</mi><mi>r</mi><mi>o</mi><mi>m</mi><mi>e</mi></mrow></msub></mrow><annotation encoding=\"application/x-tex\">_{the morning after syndrome}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6222159999999999em;vertical-align:-0.286108em;\"></span><span class=\"mord\"><span></span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361079999999999em;\"><span style=\"top:-2.5500000000000003em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">h</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mathnormal mtight\">i</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal mtight\">a</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal mtight\">t</span><span class=\"mord mathnormal mtight\">e</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">s</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span><span class=\"mord mathnormal mtight\">n</span><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\">o</span><span class=\"mord mathnormal mtight\">m</span><span class=\"mord mathnormal mtight\">e</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.286108em;\"><span></span></span></span></span></span></span></span></span></span>’이라고 부른다.</em></strong>  - <strong><em>클린 아키텍처 116p</em></strong></p>\n</blockquote>\n<p>객체 세계에서 패키지가 패키지를 의존하는 것은 너무나 자연스러운 일이다. 각각의 객체는 서로가 필요한 순간에 적절히 의존하여 메시지를 전달해야 한다. 하지만 <code class=\"language-text\">의존이 순환하는 것</code>은 큰 파장을 불러일으킨다. 이것은 패키지 사이에도 동일하게 적용된다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 677px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/8830654d86f019973bf3198b50c7a71c/3c503/image-1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 44.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiklEQVQoz21Sa2/CMBDr//9ToE1sAj4gYAWNAeLVF7QwSgsU2nh2BGhDO+mUJr3YPuecuN/HoF6Hy5y128BuhzII4Pd6WLsu/G4X+WwGbLeowhAmioA4RjGZ4Hw+43K5oCgKHI9HKJxsOoUfBlitVtgSrDIGNYInBFBmeY7P0QgnXr7HIcsQLhYY8dwdDDAcDuH7PnliOEiSR2F2OCCkiuVyaTNgked5CKk43mwQUV1OAq3F9QqXHTQaDdRqNTa2s6BOPp9jwcszttVn+1uqUlRVZbMsS7tXe1JUp3open95oZYEGxJJWUBSkTnfX18WJLkplSLDtp9Dl+RTmqbYM0evr6jK6x9S6+GJXgRss9lsotVqYb/f2x8qEvC9WGCdTsd2sl6vkVIIC3CnVq3S0YvdQ+zyZ0WVeiSPnuj7g16F8u/2kja4N1RnfoFZQBP4MDRYSf2Shgm98uhtQG8jAr7RL8Px0H+ttp6E/wNqtmio5ksr+0FJZd8ETcdju2qv80cdx8yQ7BlM+QPax6jpkNvrEQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='image 1' title='image 1' src='/static/8830654d86f019973bf3198b50c7a71c/3c503/image-1.png' srcset='/static/8830654d86f019973bf3198b50c7a71c/e7570/image-1.png 170w,\n/static/8830654d86f019973bf3198b50c7a71c/f46e7/image-1.png 340w,\n/static/8830654d86f019973bf3198b50c7a71c/3c503/image-1.png 677w' sizes='(max-width: 677px) 100vw, 677px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>의존성을 <code class=\"language-text\">비순환</code>하도록 개선하는 것만으로도 문제 발생의 포인트 지점을 쉽게 파악하고 관리할 수 있다. 이상적인 의존 구조는 <code class=\"language-text\">비순환 방향 그래프</code>의 형태를 띄게 될 것이다. 이것을 적절히 지키기 위한 원칙을 <code class=\"language-text\">의존성 비순환 원칙</code>이라 한다. </p>\n<h2>순환 참조 개선</h2>\n<p>이처럼 순환 참조 구조는 특정 패키지/객체에 변화가 생기면 연쇄적으로 영향을 받을 수 있기 때문에 유연하게 대응할 수 없다. 때문에 객체의 의존이 <code class=\"language-text\">단방향</code>으로 흐를 수 있도록 개선해야 한다. </p>\n<p>IntelliJ에서는 패키지 간의 순환 참조를 확인하기 위한 기능을 제공한다.</p>\n<blockquote>\n<p>상단탭 <code class=\"language-text\">Code</code> → <code class=\"language-text\">Analyze Code</code> → <code class=\"language-text\">Cyclic Dependencies…</code> 클릭</p>\n</blockquote>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 659px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/2699bcd0cb5d79e60906f3a5404b6170/4978c/image-2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 112.94117647058823%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAADnklEQVQ4y41VyY7bRhTUPQGyAD7ESTCLJW7aKFHcm7soShp5xogPEwMBnIMNA0aSQ66JERj58Eq9lmVLM2Mgh0I3m2J1vffqPfUmzgSxH2NkjWAPbFz+eIH+WR/n35/j4odzPl/i7PEZzEuTZxfcn+O7R4/x1Rdf45svv72HXuxGKIMCVVhiGdUoZgpqFCGbxFCCMd/zLBoFMC5MEluwnthw+kPYfYcYnqBXqRybaoU2b9CqmsQKuRefoPJTZIzCHjowTQOmZe5X07yHXp6kaLIKVZojD1MofngXVZxBhQlsx9EfWRZVmg+jl/HHDZUtqbBMCiSL5A5ivUZcneER4QdoZdb+TNZeSaJnu580iqSC74YIZxECIpzFCOeCBME84kc2BoMBDMPQOFar96LwanONN6/e4s3rt3j+7BareoNN+5TYYdVs0ZSdPisVc1y1WDcd362xLJeYjVxM7DGmdIo7nGLMfa/Ialx119iu9iQdSdbtFXbrG02UBBnSMEfE4kha1jUvKFt0LGSVlvDGc8xHM52a+XiGXhJlyBlqFpdahaw+wxUEDFcQ+UqnQEh23U4Td/UK23ajLxDCxcSDS8UkzDWRQIhVVLAA6QlEZcgcbpo1brbXqBlV4PpwnekJJHytUMiaYqXViaLQS05QZUuGnDB/G6Znx9Rs9QWuM2MePYJhjz3mckofqkrnT+fpgyIh+aQwQUyF8SLC06bBdbvEpixQRxEK38PcHMCzDHg0uivGFoV11mp1Eq5A9gdiQeLTNuES6xd/Y/fLX7h5+Y74B97qNwzilzCTX2Gkr2AurunDrMGy6HTIEprkUVIgedMFIXHNKPyoQ377L6qf36N+8R7q+Tv089/RL/7Q65PyTxjhLXppnNPQtSaSsEXRobqakM9KKu8ukC8WyDwPaj5HPJ0wXGMfLjtkYZtwpVMkh+JD8WCR1veKcngW2yhemNEVKmRvB4qXBLSLr4simEhRMpqzo4HFxKIw8bMTywiZ5DXwIkzpM3dEi4xdjdl4/zyyhhpDy9kXRZQdvHhsncMq5yGrLc0/MD718se9uYceX2lcoMlbXZSa66EYB8KYXSLvIs5E27ZPJs1D0EWp1PKjQiG4q7BIqZDWsUh4mDAPDde9wqPWkxw+1CniAlF4TPhZhZJD8Z8QyqrCAmmQ69CjAynnoc9Ws/8PYSa24UzcsEfX3RVWS87DNcfYiv1KVT6rG3B0+Wy9k7+Az+A/IGTuEzfjgpMAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='image 2' title='image 2' src='/static/2699bcd0cb5d79e60906f3a5404b6170/4978c/image-2.png' srcset='/static/2699bcd0cb5d79e60906f3a5404b6170/e7570/image-2.png 170w,\n/static/2699bcd0cb5d79e60906f3a5404b6170/f46e7/image-2.png 340w,\n/static/2699bcd0cb5d79e60906f3a5404b6170/4978c/image-2.png 659w' sizes='(max-width: 659px) 100vw, 659px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>자 이제 달록의 패키지 순환 참조 유무를 확인해보자. 나름대로 <code class=\"language-text\">객체 사이의 의존성</code>을 고려하여 진행 했다고 자부하지만 그럼에도 <code class=\"language-text\">패키지 사이의 의존성</code> 까지는 고려하지 못했다. 아래 사진을 보면 패키지 간의 <code class=\"language-text\">순환 참조 발생 지 점</code>을 확인할 수 있다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/80fbf3c9e43171f2d69802ad8de8a3c6/dff2b/image-3.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 48.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABzUlEQVQoz22SW2/TQBCF/VegCPGESpsE4svefF+vvb4QJ2mCGgQtokj8BJ5aCRX+82HstBCFPnw6Z8c7O3MkO/nqM9rLb8gXO4R2g6jeIm4+gOseblgcYDBXpE/wWPfojmNXaywvtqjqGm7A4Pp7PPI+Ywg4R8A4GA+QZjGEYKPnj0oIyegcwPfncIKsxTwuaaMOblJhInLMaNrAaZDi5VTg1dTHVH8H394jvrxF9+X3SHN9D3v1C2rzE2x1h7f1DzhJ1SK3HRJTI9IVVGYQ5hVRQqT0cBBi4jKKVYPbT0j6a7QXX9FsblD2V8jbjwirHVS5A9NbODKKoKKYoom/UYfog3oUdaj7hOe5cKWE0BmMKVBWJbI8ox4P3gFOlGQoqhraVDCDlhZl3Y61vKCmwiA3g1ZEiSQvRo0zPaou6Z6xSPXeOypO0HQL2KajD/+aVJyCqwhMhv9xWD++4wRCounX6Bb9uJGMEoooKTanyA9x2TH8idoe553HIFONYrFG2y/xvl+hXSxhbDvGz8YhKRht4nFFAwihRu/SAy6TD+y98/yM4YR4NlV47SrMeIxJaDGLLM6lwRuucco0Kf1G5IfaLK5xJgq8OOc4OeIP6BJqWKZxljAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='image 3' title='image 3' src='/static/80fbf3c9e43171f2d69802ad8de8a3c6/ca1dc/image-3.png' srcset='/static/80fbf3c9e43171f2d69802ad8de8a3c6/e7570/image-3.png 170w,\n/static/80fbf3c9e43171f2d69802ad8de8a3c6/f46e7/image-3.png 340w,\n/static/80fbf3c9e43171f2d69802ad8de8a3c6/ca1dc/image-3.png 680w,\n/static/80fbf3c9e43171f2d69802ad8de8a3c6/dff2b/image-3.png 767w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>자 이제 순환 참조가 발생하는 코드를 간단히 살펴보자.</p>\n<p><code class=\"language-text\">schedule</code> 패키지에 소속된 <code class=\"language-text\">IntegrationSchedule</code> 객체는 특정 행위를 달성하기 위해 <code class=\"language-text\">subscription</code> 패키지를 의존하고 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>allog<span class=\"token punctuation\">.</span>dallog<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span>schedule<span class=\"token punctuation\">.</span>domain</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>allog<span class=\"token punctuation\">.</span>dallog<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span>subscription<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">Subscription</span></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// subscription 패키지 의존</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">IntegrationSchedule</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isSameCategory</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Subscription</span> subscription<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Category</span> category <span class=\"token operator\">=</span> subscription<span class=\"token punctuation\">.</span><span class=\"token function\">getCategory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> category<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>categoryId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">subscription</code> 패키지에 소속된 <code class=\"language-text\">Subscriptions</code> 객체도 <code class=\"language-text\">IntegrationSchedule</code>를 의존하는 형태를 띄고 있다. </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>allog<span class=\"token punctuation\">.</span>dallog<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span>subscription<span class=\"token punctuation\">.</span>domain</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>allog<span class=\"token punctuation\">.</span>dallog<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span>schedule<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IntegrationSchedule</span></span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// schedule 패키지 의존</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Subscriptions</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Color</span> <span class=\"token function\">findColor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">IntegrationSchedule</span> schedule<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> subscriptions<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>schedule<span class=\"token operator\">::</span><span class=\"token function\">isSameCategory</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">findAny</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NoSuchCategoryException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"구독하지 않은 카테고리 입니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">getColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 문제가 되는 부분을 개선해보자!</p>\n<p>먼저 기존에 <code class=\"language-text\">IntegrationSchedule</code>에서 의존하던 <code class=\"language-text\">Subscription</code>을 제거한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>allog<span class=\"token punctuation\">.</span>dallog<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span>schedule<span class=\"token punctuation\">.</span>domain</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">IntegrationSchedule</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">isSameCategory</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">Category</span> category<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">Long</span> categoryId <span class=\"token operator\">=</span> category<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>categoryId<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>categoryId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>변경된 메서드에 맞춰 사용하던 부분까지 적절히 수정한다. </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">package</span> <span class=\"token namespace\">com<span class=\"token punctuation\">.</span>allog<span class=\"token punctuation\">.</span>dallog<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span>subscription<span class=\"token punctuation\">.</span>domain</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token keyword\">import</span> <span class=\"token import\"><span class=\"token namespace\">com<span class=\"token punctuation\">.</span>allog<span class=\"token punctuation\">.</span>dallog<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span>schedule<span class=\"token punctuation\">.</span>domain<span class=\"token punctuation\">.</span></span><span class=\"token class-name\">IntegrationSchedule</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Subscriptions</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Color</span> <span class=\"token function\">findColor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">IntegrationSchedule</span> schedule<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> subscriptions<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>subscription <span class=\"token operator\">-></span> schedule<span class=\"token punctuation\">.</span><span class=\"token function\">isSameCategory</span><span class=\"token punctuation\">(</span>subscription<span class=\"token punctuation\">.</span><span class=\"token function\">getCategory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">findAny</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NoSuchCategoryException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"구독하지 않은 카테고리 입니다.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">getColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 <code class=\"language-text\">subscription</code> 패키지가 <code class=\"language-text\">schedule</code> 패키지를 <code class=\"language-text\">단방향 의존</code>하고 있다. </p>\n<p>다시 한번 IntelliJ를 통해  <code class=\"language-text\">Cyclic Dependencies…</code>를 통해 패키지 순환 구조를 확인해보자.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 332px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/e1a0e527f33a50405a07b3dd4e4cc992/557e0/image-4.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 41.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaUlEQVQoz42PzXLSUBiGc0cdFyohJyH/aQjhJBEKCQGBMDJa65RS7c4FG+/Fa3DGceNCHG/p8ZDqxhmnXTzz/n2bTzODlPNsSpyX/+i01UhOiIYXJEXVbqHyser7Kv/dT70TF5iBRBNJRbrYIV/uSOt3jJs92WpPvr5tNV1cE8+uVL7v+8rL5Y6iuVV60+7Z6gZ3tMWUDVrQl7iKp5HNoN4wfv2e+eYN5aKhXC7p2hG6HdDp3dO1Q/STt4JW9T+94UQI9xzNsgR+6OL6lnohI56UZDJByoEiwbIMDKODELqi83/UzelOe+aMiCaXDJs78tk1srwivrhE1jvy+R5nuKET1ujRHD18GO2s+oz59ivywxdmh5+UhyP14Qfp3XeVj6w+/WL88ciT5htn64fRnvf6DEZrRostefUKOWl4MdtSVFu8ZIrwc0RQ0PXyR6F1hcC2e7iewvewHRtPqR/6WD0LQ+2GKRCP5DdAbjfhuMfF8QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='image 4' title='image 4' src='/static/e1a0e527f33a50405a07b3dd4e4cc992/557e0/image-4.png' srcset='/static/e1a0e527f33a50405a07b3dd4e4cc992/e7570/image-4.png 170w,\n/static/e1a0e527f33a50405a07b3dd4e4cc992/557e0/image-4.png 332w' sizes='(max-width: 332px) 100vw, 332px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>패키지 순환 구조가 깔끔히 제거된 것을 확인할 수 있다.</p>\n<h2>정리</h2>\n<p>간단한 시나리오를 기반으로 순환 참조하는 구조가 어떠한 문제를 야기하는지 알아보았다. 순환 참조는 문제의 발생 지점을 명확하게 파악하기 어렵다. 즉 의존 방향이 <code class=\"language-text\">단방향</code>으로 향하도록 해야 한다.</p>\n<p>IntelliJ에 다양한 기능을 활용하면 손쉽게 의존 구조를 파악할 수 있다. 주기적으로 패키지/객체 사이의 의존을 확인하며 프로젝트를 진행하다 보면 보다 더 견고한 서비스를 만들 수 있을 것이라 기대한다.</p>\n<h2>References.</h2>\n<ul>\n<li>로버트 C.마틴 지음, 송준이 옮김, 『클린 아키텍처』 (인사이트, 2019), 116p.</li>\n<li><a href=\"https://jojoldu.tistory.com/603?category=1011740\">https://jojoldu.tistory.com/603?category=1011740</a></li>\n</ul>","frontmatter":{"title":"cyclic dependency","date":"September 30, 2022","update":"September 30, 2022","tags":["매트","BE","cyclic dependency","순환 의존"],"series":null},"fields":{"slug":"/cyclic-dependency/","readingTime":{"minutes":9.695}}},"seriesList":{"edges":[{"node":{"id":"a621dc7b-8590-5ec6-9b52-3d9e5182486d","fields":{"slug":"/appearance-background-of-jpa/"},"frontmatter":{"title":"JPA 등장배경"}}},{"node":{"id":"9d2a87b6-2b9c-5b87-b790-3426d17c2d8e","fields":{"slug":"/intellij-final-keyword/"},"frontmatter":{"title":"IntelliJ에서 메소드 추출한 메소드의 파라미터에 final 키워드 자동 추가하기"}}},{"node":{"id":"251e9767-1c92-5cf5-9cef-2c4a42c10df2","fields":{"slug":"/git-branch-strategy/"},"frontmatter":{"title":"달록팀의 git 브랜치 전략을 소개합니다."}}},{"node":{"id":"5090cce3-0c1f-5376-badc-1d25e44c1bd9","fields":{"slug":"/infinite-scroll/"},"frontmatter":{"title":"React에서 무한 스크롤 구현하기"}}},{"node":{"id":"bcb53ba5-0286-5d10-96c2-fdcb88e2cc60","fields":{"slug":"/package-structure/"},"frontmatter":{"title":"달록에 적절한 패키지 구조 고민하기"}}},{"node":{"id":"a7fc89de-f37c-596e-a81d-3d4fe5a795b8","fields":{"slug":"/data-jpa-slice-page/"},"frontmatter":{"title":"Spring Data JPA의 Slice & Page"}}},{"node":{"id":"e1ba92ee-0cf0-50c8-80bd-5da5075df8d1","fields":{"slug":"/data-jpa-auditing/"},"frontmatter":{"title":"Spring Data JPA의 Auditing"}}},{"node":{"id":"3e036508-c916-504e-9e8d-89f69332471e","fields":{"slug":"/separated-interface/"},"frontmatter":{"title":"외부와 의존성 분리하기"}}},{"node":{"id":"cade544a-16ef-58a3-b97c-824986a8395f","fields":{"slug":"/apply-rest-docs/"},"frontmatter":{"title":"MockMvc를 사용한 Spring RestDocs"}}},{"node":{"id":"87649d54-d59e-58a6-afd5-8491eb4113a8","fields":{"slug":"/properties-to-object/"},"frontmatter":{"title":"properties 객체로 다루기"}}},{"node":{"id":"eb380f6d-5a00-5a9e-a916-003fb292cc8a","fields":{"slug":"/test-fixture-constant/"},"frontmatter":{"title":"테스트에서 Entity 객체를 상수로 두면 안 되는 이유"}}},{"node":{"id":"9734e30a-b430-5922-919d-f53808a56eb9","fields":{"slug":"/what_is_nginx/"},"frontmatter":{"title":"NGINX 란?"}}},{"node":{"id":"9ebc6e21-2a76-5d42-be33-c2dae8c849b2","fields":{"slug":"/ssl_protocol/"},"frontmatter":{"title":"SSL을 통한 HTTPS통신 과정"}}},{"node":{"id":"fa5ad595-1f81-5a20-a884-2da69adee3c5","fields":{"slug":"/integration-test-slice-test/"},"frontmatter":{"title":"통합 테스트와 슬라이스 테스트"}}},{"node":{"id":"d8c66823-bb05-5e83-a6a1-2fd9af450b6f","fields":{"slug":"/query-invalidation/"},"frontmatter":{"title":"React-Query에서의 데이터 최신화 (Query Invalidation)"}}},{"node":{"id":"f5187517-342f-52a1-9092-d12c1a80d132","fields":{"slug":"/seperate-components/"},"frontmatter":{"title":"컴포넌트 분리 기준"}}},{"node":{"id":"d6249c8b-bea6-5c91-8477-d3dd15ad9b39","fields":{"slug":"/test-isolation/"},"frontmatter":{"title":"테스트 격리"}}},{"node":{"id":"98e390ef-fb19-5d01-a3ef-d14bc0e65176","fields":{"slug":"/dallog-jacoco/"},"frontmatter":{"title":"달록의 Jacoco 적용기 (feat. Gradle)"}}},{"node":{"id":"33d19946-de0c-5b41-bfa0-d7c3fd80f10b","fields":{"slug":"/google-refresh-token/"},"frontmatter":{"title":"Google은 Refresh Token을 쉽게 내주지 않는다."}}},{"node":{"id":"8168857d-a82c-5608-bd40-cea4b917d17d","fields":{"slug":"/submodule/"},"frontmatter":{"title":"달록 서브모듈 도입기"}}},{"node":{"id":"836fc724-7e2f-5c7a-a42b-c0cc9163167a","fields":{"slug":"/dallog-flyway/"},"frontmatter":{"title":"달록의 데이터베이스 마이그레이션을 위한 Flyway 적용기"}}},{"node":{"id":"7a3bde6d-746b-56fd-8d91-0d8059ebf1f8","fields":{"slug":"/json-property-json-naming/"},"frontmatter":{"title":"@JsonProperty, @JsonNaming"}}},{"node":{"id":"50673f5c-f835-5982-b70c-b77e5a352a2c","fields":{"slug":"/servlet-life-cycle/"},"frontmatter":{"title":"서블릿 생명주기와 직접만든 톰캣을 통한 의문점"}}},{"node":{"id":"61e7f4d1-7b3a-5968-bfe8-c3f6efb88748","fields":{"slug":"/preparing-for-performance-test/"},"frontmatter":{"title":"톰캣 튜닝을 위한 달록의 서버 성능 테스트 준비 과정"}}},{"node":{"id":"9272061d-68c6-5f82-a961-0e2efe0fd6be","fields":{"slug":"/cyclic-dependency/"},"frontmatter":{"title":"cyclic dependency"}}},{"node":{"id":"6e779308-f266-58af-bfcc-e9fee6d39a98","fields":{"slug":"/multi-datasource-issue-with-osiv/"},"frontmatter":{"title":"대체 왜 DataSource 라우팅이 안되는거야!? (feat. OSIV)"}}},{"node":{"id":"0e63245e-c52c-5977-9f60-f94ee0fd00fc","fields":{"slug":"/hikari-cp-theory/"},"frontmatter":{"title":"HikariCP와 적절한 풀 사이즈 고민하기 (이론편)"}}},{"node":{"id":"c7bea043-345c-5f78-ae53-796a83812961","fields":{"slug":"/react-query-useMutation-trouble-shooting/"},"frontmatter":{"title":"react-query useMutation onSuccess 안 되는줄 알았던 트러블 슈팅"}}},{"node":{"id":"cf403487-1c48-5ca7-b5c2-ef0d8fefe3c4","fields":{"slug":"/jenkins-distributed-build-architecture/"},"frontmatter":{"title":"젠킨스 분산 빌드 아키텍처 구축"}}},{"node":{"id":"24c152c7-4e94-5b84-aaea-a5a9a8357693","fields":{"slug":"/zero-downtime-deployment/"},"frontmatter":{"title":"달록 무중단 배포 도입기"}}},{"node":{"id":"623f9105-974d-51b9-84c7-f6298a8d1c19","fields":{"slug":"/get-valid-accessToken/"},"frontmatter":{"title":"refreshToken으로 accessToken 재발급하기"}}}]},"previous":{"fields":{"slug":"/preparing-for-performance-test/"},"frontmatter":{"title":"톰캣 튜닝을 위한 달록의 서버 성능 테스트 준비 과정"}},"next":{"fields":{"slug":"/db-time-1-timestamp-2038/"},"frontmatter":{"title":"달력 서비스의 DB 시간 다루기 1 - TimeStamp 2038 문제"}}},"pageContext":{"id":"9272061d-68c6-5f82-a961-0e2efe0fd6be","series":null,"previousPostId":"61e7f4d1-7b3a-5968-bfe8-c3f6efb88748","nextPostId":"ecbb184e-af6e-56c3-bcc7-1dd21db8187d"}},"staticQueryHashes":[]}